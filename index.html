<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pebble ‚Äî Gioco di cura della lontra</title>
  <meta name="description" content="Prenditi cura della tua adorabile lontra virtuale! Un gioco web rilassante ispirato a Pou ma pi√π tenero. Nutrila, gioca, puliscila e guardala crescere felice." />
  <meta name="keywords" content="lontra, gioco, pet virtuale, tamagotchi, pou, animali, cute, kawaii" />
  <meta name="author" content="Pebble Team" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Pebble ü¶¶ - Gioco di cura della lontra" />
  <meta property="og:description" content="Un adorabile gioco web per prendersi cura di una lontra virtuale. Pi√π tenero di Pou!" />
  <meta property="og:image" content="./icons/icon-512.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Pebble ü¶¶ - Gioco di cura della lontra" />
  <meta name="twitter:description" content="Prenditi cura della tua lontra virtuale!" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" type="image/png" sizes="32x32" href="./icons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="./icons/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Pebble" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css" />
  <script type="importmap">
    {
      "imports": {
        "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2?bundle"
      }
    }
  </script>
  <script>
    if (!('chrome' in globalThis)) {
      globalThis.chrome = {};
    }
  </script>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="header-left">
        <div aria-live="polite">
          <h1 id="petNameLabel">Pebble</h1>
        </div>
        <nav class="desktop-nav" aria-label="Navigazione principale">
          <button class="desktop-nav-item active" data-page="den" aria-pressed="true">Tana</button>
          <button class="desktop-nav-item" data-page="kitchen" aria-pressed="false">Cucina</button>
          <button class="desktop-nav-item" data-page="hygiene" aria-pressed="false">Fiume</button>
          <button class="desktop-nav-item" data-page="games" aria-pressed="false">Giochi</button>
          <button class="desktop-nav-item" data-page="shop" aria-pressed="false">Mercante</button>
        </nav>
      </div>
      <div class="header-right">
        <button
          id="settingsBtn"
          class="icon-btn settings-btn"
          type="button"
          aria-haspopup="dialog"
          aria-controls="settingsOverlay"
          aria-label="Apri impostazioni"
        >‚öôÔ∏è</button>
        <div class="coins-display" aria-live="polite">
          <span aria-hidden="true">ü™ô</span>
          <span id="coins">0</span>
        </div>
      </div>
    </div>
  </header>
  <div
    id="nameOverlay"
    class="overlay hidden"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-labelledby="nameOverlayTitle"
  >
    <div class="name-card">
      <h2 id="nameOverlayTitle">Scegli il nome della tua lontra</h2>
      <p>Personalizza l'avventura dando un nome unico alla tua nuova amica.</p>
      <form id="nameForm" class="name-form" autocomplete="off">
        <label class="name-label" for="petNameInput">Nome lontra</label>
        <input
          id="petNameInput"
          class="name-input"
          name="petName"
          type="text"
          maxlength="24"
          spellcheck="false"
          placeholder="Es. Luna"
          required
        />
        <button type="submit" class="primary-btn full-width">Conferma nome</button>
      </form>
    </div>
  </div>

  <main>
    <section id="denPage" class="scene den-scene active" aria-hidden="false" aria-label="La tana della lontra">
      <div class="scene-frame">
        <header class="scene-header">
          <h2>Rifugio della Tana</h2>
          <p>Riposati con Pebble, osserva il suo umore e usa il diario per tenere traccia dei progressi.</p>
        </header>
        <div class="den-atmosphere" aria-hidden="true">
          <div class="den-window">
            <span id="denWindowLabel">Riparo serale</span>
          </div>
        </div>
        <div class="den-otter" aria-live="polite">
          <img
            id="otterImage"
            class="otter-img"
            src="src/assets/otter/otter_neutral.png"
            alt="Pebble riposa nella tana"
          />
          <div id="accessories-container" aria-hidden="true"></div>
        </div>
        <div class="den-actions">
          <button id="sleepBtn" class="primary-btn scene-action" type="button">Spegni le luci</button>
          <button id="statsToggleBtn" class="secondary-btn scene-action" type="button">Apri diario e statistiche</button>
        </div>
      </div>
      <div id="denJournal" class="den-journal hidden" aria-hidden="true">
        <div class="den-journal__header">
          <h2>Diario di Pebble</h2>
          <p class="small-text">Statistiche rapide del tuo compagno di fiume.</p>
        </div>
        <p class="den-journal__note">Controlla fame, energia, pulizia e felicit√† per capire cosa desidera Pebble.</p>
        <div class="status-container" role="list">
          <div class="status-item" role="listitem">
            <div class="status-icon" aria-hidden="true">üçó</div>
            <div class="progress-bar" aria-label="Fame">
              <div id="hungerBar" class="progress-fill"></div>
            </div>
          </div>
          <div class="status-item" role="listitem">
            <div class="status-icon" aria-hidden="true">üéâ</div>
            <div class="progress-bar" aria-label="Felicit√†">
              <div id="happyBar" class="progress-fill"></div>
            </div>
          </div>
          <div class="status-item" role="listitem">
            <div class="status-icon" aria-hidden="true">üßº</div>
            <div class="progress-bar" aria-label="Pulizia">
              <div id="cleanBar" class="progress-fill"></div>
            </div>
          </div>
          <div class="status-item" role="listitem">
            <div class="status-icon" aria-hidden="true">‚ö°</div>
            <div class="progress-bar" aria-label="Energia">
              <div id="energyBar" class="progress-fill"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="kitchenPage" class="scene kitchen-scene hidden" aria-hidden="true" aria-label="La roccia del picnic">
      <div class="scene-frame">
        <header class="scene-header">
          <h2>Roccia del Picnic</h2>
          <p>Prepara uno snack e trascinalo sulla lontra, oppure tocca un alimento per servirlo subito.</p>
        </header>
        <div class="kitchen-otter" aria-live="polite">
          <img
            class="otter-img"
            src="src/assets/otter/otter_neutral.png"
            alt="Pebble attende uno spuntino"
          />
        </div>
        <p class="scene-instructions">Trascina un alimento sulla zona di servizio oppure tocca il pulsante rapido qui sotto.</p>
        <div id="kitchenDropZone" class="kitchen-dropzone" aria-label="Area dove servire il cibo">
          <span class="kitchen-dropzone-hint">Trascina qui uno snack per Pebble</span>
        </div>
      </div>
      <div class="food-drawer" aria-label="Dispensa del picnic">
        <button class="food-item" draggable="true" data-food="fish">üêü Pesce fresco</button>
        <button class="food-item" draggable="true" data-food="berry">üçì Frutti di bosco</button>
        <button class="food-item" draggable="true" data-food="clam">ü¶™ Vongola</button>
      </div>
      <div class="kitchen-shortcuts">
        <button id="kitchenFeedBtn" class="primary-btn" type="button">Servi uno snack rapido</button>
        <p class="kitchen-tip">Suggerimento: trascina e rilascia gli alimenti sulla lontra per variare la dieta.</p>
      </div>
      <button id="feedBtn" class="visually-hidden" type="button">Nutri</button>
    </section>

    <section id="hygienePage" class="scene hygiene-scene hidden" aria-hidden="true" aria-label="Il fiume basso">
      <div class="scene-frame">
        <header class="scene-header">
          <h2>Fiume Limpido</h2>
          <p>Accompagna Pebble al bagnetto e strofina con movimenti delicati per far brillare il suo manto.</p>
        </header>
        <div class="hygiene-river">
          <div class="hygiene-otter" aria-live="polite">
            <img
              class="otter-img"
              src="src/assets/otter/otter_neutral.png"
              alt="Pebble fa il bagnetto"
            />
            <div class="hygiene-bubbles" aria-hidden="true"></div>
          </div>
          <div class="hygiene-tools">
            <button id="bathBtn" class="primary-btn scene-action" type="button">Passa la spugna</button>
          </div>
        </div>
        <p class="scene-instructions">Massaggia la lontra con movimenti circolari per farla brillare di felicit√†.</p>
      </div>
    </section>

    <section id="gamesPage" class="scene games-scene hidden" aria-hidden="true" aria-label="Il prato dei giochi">
      <div class="scene-frame">
        <header class="scene-header">
          <h2>Prato dei Giochi</h2>
          <p>Scegli un‚Äôattivit√† per guadagnare sassolini e intrattenere Pebble.</p>
        </header>
        <div class="games-otter" aria-live="polite">
          <img
            class="otter-img"
            src="src/assets/otter/otter_happy.png"
            alt="Pebble scalpita per giocare"
          />
        </div>
        <div class="games-grid">
          <button id="playBtn" class="game-card" type="button">
            <span class="game-card__icon" aria-hidden="true">üé£</span>
            <span class="game-card__title">Acchiappa i pesci</span>
            <span class="game-card__meta">Mini-gioco attivo ‚Ä¢ 10s</span>
          </button>
          <div class="game-card">
            <span class="game-card__icon" aria-hidden="true">ü™®</span>
            <span class="game-card__title">Stone Polishing</span>
            <p id="stonePolishingStatus" class="game-card__meta">Premi Inizia e strofina per rivelare il sasso lucente.</p>
            <div id="stonePolishingWrapper" class="stone-polishing-container hidden" aria-live="polite"></div>
            <button id="stonePolishingStartBtn" class="secondary-btn" type="button">Inizia rituale</button>
          </div>
        </div>
      </div>
    </section>

    <section id="shopPage" class="scene shop-scene hidden" aria-hidden="true" aria-label="Il mercante della valle">
      <div class="scene-frame">
        <div class="page-header">
          <h2>Bancarella del mercante</h2>
          <p>Scambia i tuoi sassolini per nuovi accessori e snack.</p>
        </div>
        <div class="shop-grid">
          <div class="shop-item">
            <div class="item-preview" aria-hidden="true">üé©</div>
            <div class="item-details">
              <h3>Cappello</h3>
              <span class="price">50 ü™ô</span>
            </div>
            <button class="buy-btn" data-price="50" data-item="hat">Compra</button>
          </div>
          <div class="shop-item">
            <div class="item-preview" aria-hidden="true">üï∂Ô∏è</div>
            <div class="item-details">
              <h3>Occhiali</h3>
              <span class="price">120 ü™ô</span>
            </div>
            <button class="buy-btn" data-price="120" data-item="sunglasses">Compra</button>
          </div>
          <div class="shop-item">
            <div class="item-preview" aria-hidden="true">üß£</div>
            <div class="item-details">
              <h3>Sciarpa</h3>
              <span class="price">200 ü™ô</span>
            </div>
            <button class="buy-btn" data-price="200" data-item="scarf">Compra</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="overlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div class="minigame-card" id="minigame">
      <div class="minigame-header">
        <h3>Acchiappa i pesci!</h3>
        <span class="timer">10s</span>
      </div>
      <div id="fishArea" class="fish-area"></div>
      <div class="minigame-footer">
        <span class="score">Punti: <span id="miniScore">0</span></span>
        <button id="closeMini" class="secondary-btn">Esci</button>
      </div>
    </div>
  </div>

  <div
    id="tutorialOverlay"
    class="tutorial-overlay hidden"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
  >
    <div class="tutorial-card">
      <div class="tutorial-icon" aria-hidden="true">ü¶¶</div>
      <h2>Benvenuto!</h2>
      <p>Prenditi cura della tua nuova amica lontra.</p>
      <div class="tutorial-steps">
        <div class="step"><span>1</span> Nutri e gioca per la felicit√†</div>
        <div class="step"><span>2</span> Lava e fai dormire per la salute</div>
        <div class="step"><span>3</span> Gioca ai minigiochi per monete</div>
      </div>
      <label class="toggle-row tutorial-toggle">
        <span>Statistiche anonime</span>
        <input type="checkbox" id="analyticsOptInTutorial" />
        <span class="toggle-switch"></span>
      </label>
      <button id="tutorialStart" class="primary-btn full-width">Inizia l'avventura</button>
    </div>
  </div>

  <div
    id="settingsOverlay"
    class="overlay hidden"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-labelledby="settingsTitle"
  >
    <div class="settings-modal">
      <div class="settings-modal__header">
        <h2 id="settingsTitle">Impostazioni</h2>
        <button id="settingsCloseBtn" class="icon-btn settings-close-btn" type="button" aria-label="Chiudi impostazioni">‚úï</button>
      </div>
      <div class="settings-modal__content">
        <div class="settings-card">
          <h3>Preferenze</h3>
          <label class="toggle-row">
            <span>Statistiche anonime</span>
            <input type="checkbox" id="analyticsOptInToggle" />
            <span class="toggle-switch"></span>
          </label>
          <p id="analyticsSummary" class="small-text">Statistiche disattivate.</p>
          <div class="theme-section">
            <h4>Tema</h4>
            <p class="small-text">Scegli l'atmosfera: comfort abbassa la luminosit√† serale.</p>
            <div class="theme-actions">
              <button id="themeLightBtn" class="secondary-btn" type="button">Luce</button>
              <button id="themeComfortBtn" class="secondary-btn" type="button">Comfort</button>
            </div>
          </div>
          <div class="notification-section">
            <h4>Promemoria lontra</h4>
            <p id="notificationUnsupported" class="small-text warning-text hidden">Il tuo dispositivo non supporta le notifiche push.</p>
            <p id="notificationStatus" class="small-text">Promemoria disattivati.</p>
            <p id="notificationNextDetails" class="small-text"></p>
            <div class="notification-actions">
              <button id="notificationEnableBtn" class="primary-btn" type="button">Attiva promemoria</button>
              <button id="notificationDisableBtn" class="secondary-btn" type="button">Disattiva</button>
            </div>
          </div>
        </div>
        <div class="settings-card">
          <h3>Backup e sincronizzazione</h3>
          <div class="backup-section">
            <h4>Backup salvataggi</h4>
            <p class="small-text">Esporta un file di sicurezza o ripristina i tuoi progressi su un nuovo dispositivo.</p>
            <div class="backup-actions">
              <button id="backupExportBtn" class="secondary-btn">Scarica backup</button>
              <button id="backupImportBtn" class="secondary-btn">Ripristina backup</button>
            </div>
            <input id="backupFileInput" class="visually-hidden" type="file" accept="application/json" aria-label="Seleziona file di backup" />
          </div>
          <button id="resetBtn" class="danger-btn">Reset Gioco</button>
        </div>
      </div>
    </div>
  </div>

  <div
    id="giftOverlay"
    class="overlay hidden"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-labelledby="giftTitle"
  >
    <div class="gift-card">
      <div class="gift-icon" aria-hidden="true">üéÅ</div>
      <h2 id="giftTitle">La tua lontra ha un dono!</h2>
      <p id="giftMessage" class="gift-message">Ha trovato qualcosa di speciale lungo la riva.</p>
      <div class="gift-actions">
        <button id="giftCloseBtn" class="primary-btn full-width" type="button">Che dolce!</button>
      </div>
    </div>
  </div>

  <div id="alertBanner" class="toast hidden" role="status" aria-live="polite"></div>

  <div id="updateBanner" class="toast update-toast hidden" role="alert">
    <span>Nuovo aggiornamento!</span>
    <button id="updateReload" class="small-btn">Aggiorna</button>
    <button id="updateDismiss" class="icon-btn" aria-label="Chiudi avviso">‚úï</button>
  </div>

  <div id="installBanner" class="toast install-toast hidden" role="dialog" aria-live="assertive">
    <div class="install-text">
      <strong>Installa Pebble</strong>
      <span>Scarica l'app per averla sempre a portata di tap!</span>
    </div>
    <div class="install-actions">
      <button id="installDismiss" class="icon-btn" aria-label="Chiudi avviso">‚úï</button>
      <button id="installConfirm" class="small-btn">Installa</button>
    </div>
  </div>

  <nav class="bottom-nav" id="bottomNav">
    <button class="nav-item active" data-page="den" aria-pressed="true">
      <span class="nav-icon" aria-hidden="true">
        <img
          src="src/assets/menu-icons/icon-home.png"
          srcset="src/assets/menu-icons/icon-home.png 1x, src/assets/menu-icons/icon-home@2x.png 2x, src/assets/menu-icons/icon-home@3x.png 3x"
          alt=""
          loading="lazy"
          decoding="async"
          width="32"
          height="32"
        />
      </span>
      <span class="nav-label">Tana</span>
    </button>
    <button class="nav-item" data-page="kitchen" aria-pressed="false">
      <span class="nav-icon" aria-hidden="true">
        <img
          src="src/assets/menu-icons/icon-food.png"
          srcset="src/assets/menu-icons/icon-food.png 1x, src/assets/menu-icons/icon-food@2x.png 2x, src/assets/menu-icons/icon-food@3x.png 3x"
          alt=""
          loading="lazy"
          decoding="async"
          width="32"
          height="32"
        />
      </span>
      <span class="nav-label">Cucina</span>
    </button>
    <button class="nav-item" data-page="hygiene" aria-pressed="false">
      <span class="nav-icon" aria-hidden="true">
        <img
          src="src/assets/menu-icons/icon-hygiene.png"
          srcset="src/assets/menu-icons/icon-hygiene.png 1x, src/assets/menu-icons/icon-hygiene@2x.png 2x, src/assets/menu-icons/icon-hygiene@3x.png 3x"
          alt=""
          loading="lazy"
          decoding="async"
          width="32"
          height="32"
        />
      </span>
      <span class="nav-label">Fiume</span>
    </button>
    <button class="nav-item" data-page="games" aria-pressed="false">
      <span class="nav-icon" aria-hidden="true">
        <img
          src="src/assets/menu-icons/icon-games.png"
          srcset="src/assets/menu-icons/icon-games.png 1x, src/assets/menu-icons/icon-games@2x.png 2x, src/assets/menu-icons/icon-games@3x.png 3x"
          alt=""
          loading="lazy"
          decoding="async"
          width="32"
          height="32"
        />
      </span>
      <span class="nav-label">Giochi</span>
    </button>
    <button class="nav-item" data-page="shop" aria-pressed="false">
      <span class="nav-icon" aria-hidden="true">
        <img
          src="src/assets/menu-icons/icon-shop.png"
          srcset="src/assets/menu-icons/icon-shop.png 1x, src/assets/menu-icons/icon-shop@2x.png 2x, src/assets/menu-icons/icon-shop@3x.png 3x"
          alt=""
          loading="lazy"
          decoding="async"
          width="32"
          height="32"
        />
      </span>
      <span class="nav-label">Mercante</span>
    </button>
  </nav>

  <script src="config.js" defer></script>
  <script type="module" src="dist/index.js"></script>
</body>
</html>